with poor_date as (
	select landing_airport_iata as iata, date, avg(ticket_price) as avg_fly_$
	from airport_to_flight
	group by landing_airport_iata, date
	order by avg(ticket_price) asc
	limit 30
), poor_t as (
	select p.iata, p.date, ticket_price, departure_time, landing_time, duration, airline
	from poor_date p
	join airport_to_flight f
	on p.date = f.date
)

select * from poor_t
where iata = 'IATA_var'
order by duration asc
limit 5


#旺季
with wealthy_date as (
	select landing_airport_iata as iata, date, avg(ticket_price) as avg_fly_$
	from airport_to_flight
	group by landing_airport_iata, date
	order by avg(ticket_price) desc
	limit 30
), wealthy_t as (
	select w.iata, w.date, ticket_price, departure_time, landing_time, duration, airline
	from wealthy_date w
	join airport_to_flight f
	on w.date = f.date
)

select * from wealthy_t
where iata = 'IATA_var'
order by duration asc
limit 5
